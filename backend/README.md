# WellPNA Backend

## Overview

The WellPNA backend is a Node.js/TypeScript application that provides the data processing, storage, and API services for the Well Planning and Analysis system. It handles importing well data from PDF and Excel files, storing it in a structured database, and providing APIs for the frontend to access this data.

## Major Subdirectories

- `src/` - Main source code
  - `services/` - Business logic for data processing, file generation, and bid generation
  - `resolvers/` - GraphQL resolvers for API endpoints
  - `__tests__/` - Unit tests for various components
- `prisma/` - Database schema and migrations

## Technology Stack

- Node.js with TypeScript
- Prisma ORM with SQLite database
- GraphQL API with Apollo Server
- PDF processing with pdf2json
- Excel processing with ExcelJS
- PDF generation with jsPDF
- Authentication with JWT and bcrypt

## Project Layout Plan

1. **Data Ingestion Layer** (`src/services/dataMiner.ts`)
   - Parses PDF and Excel files to extract well data
   - Normalizes data into structured format

2. **Data Storage Layer** (`prisma/schema.prisma`)
   - Defines the database schema for well data
   - Uses Prisma ORM for database operations

3. **Business Logic Layer** (`src/services/`)
   - Implements core functionality like file generation and bid generation
   - Processes data for specific use cases

4. **API Layer** (`src/resolvers/`)
   - Exposes GraphQL endpoints for frontend consumption
   - Handles data queries and mutations

5. **Authentication** (`src/auth.ts`)
   - Manages user authentication and authorization
   - Implements JWT-based security

## Data Model

The backend uses Prisma ORM to manage a comprehensive well data model including:

- Wells with API numbers, locations, and depths
- Casing records
- Perforation intervals
- Plug schedules
- Mechanical isolation data
- Geological information
- Operator details

## Key Services

- **Data Miner**: Extracts well data from PDF and Excel files
- **File Generator**: Creates reports in PDF and Excel formats
- **Bid Generator**: Generates bid documents (in development)
- **Well Service**: Core well data management
- **Wellbore Diagram Service**: Generates wellbore visualizations

## Component Architecture

### Backend Components
- **Services** (`src/services/`): Contain business logic for specific functionalities
- **Resolvers** (`src/resolvers/`): Handle GraphQL API requests (not yet implemented)
- **Models** (`src/generated/`): Generated by Prisma based on the schema
- **Authentication** (`src/auth.ts`): Handles user authentication and authorization

## Setup

1. Install dependencies: `npm install`
2. Set up the database: `npx prisma migrate dev`
3. Start the server: `npm run dev`

## Testing

Run tests with: `npm test`

## API Endpoints

The backend exposes a GraphQL API with the following main types of operations:

- User authentication (login, signup)
- Well data queries (by API number, location, etc.)
- Data mutations (create, update, delete wells)
- File generation requests
- Wellbore diagram data retrieval
